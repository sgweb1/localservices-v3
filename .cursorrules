# Local Services Dashboard - ReguÅ‚y Cursor AI

## ğŸ—ï¸ ARCHITEKTURA SYSTEMU

### Stack Techniczny
```
BACKEND (Laravel 12 API)
â”œâ”€â”€ Routes: /routes/api.php
â”œâ”€â”€ Controllers: /app/Http/Controllers/
â”œâ”€â”€ Models: /app/Models/
â”œâ”€â”€ Observers: /app/Observers/ (event listeners)
â”œâ”€â”€ Services: /app/Services/ (business logic)
â””â”€â”€ Database: /database/migrations/

FRONTEND (React 18 + TypeScript)
â”œâ”€â”€ Vite (dev server)
â”œâ”€â”€ @tanstack/react-query v5 (server state management)
â”œâ”€â”€ React Router v6 (routing)
â”œâ”€â”€ Tailwind CSS + custom components
â””â”€â”€ Broadcasting: null (WebSockets disabled MVP)

STRUKTURA FOLDERU:
src/
â”œâ”€â”€ components/ui/          â† Komponenty ogÃ³lne (zawsze uÅ¼ywaj!)
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ provider/           â† Dashboard dostawcy usÅ‚ug
â”‚   â”‚   â”œâ”€â”€ pages/          â† PeÅ‚ne widoki (BookingsPage.tsx)
â”‚   â”‚   â”œâ”€â”€ dashboard/      â† Dashboard widgets
â”‚   â”‚   â”œâ”€â”€ subscription/   â† PÅ‚atnoÅ›ci + subskrypcje
â”‚   â”‚   â””â”€â”€ monetization/   â† Boost + promocje
â”‚   â”œâ”€â”€ customer/           â† Panel klienta
â”‚   â”œâ”€â”€ admin/              â† Panel administracyjny
â”‚   â””â”€â”€ shared/             â† WspÃ³lny kod
â””â”€â”€ hooks/                  â† Custom React Hooks
```

### Query Deduplication (React Query)
```typescript
// PROBLEM: Komponenty mogÄ… robiÄ‡ duplikaty requestÃ³w
// ROZWIÄ„ZANIE: Inicjalizuj ALL queries w TOP-LEVEL component

// âœ… POPRAWNIE (DashboardPage.tsx)
export function DashboardPage() {
  // Wszystkie query startujÄ… w tym samym render cycle
  useRecentBookings(5);      // React Query widzi queryKey
  useRecentMessages(5);      // JeÅ›li inny component teÅ¼ to robi
  useRecentReviews(4);       // â†’ automatycznie deduplikuje do 1 requesta!
  
  return (
    <>
      <RecentBookings />    {/* UÅ¼ywa cache z top-level */}
      <RecentMessages />    {/* UÅ¼ywa cache z top-level */}
      <RecentReviews />     {/* UÅ¼ywa cache z top-level */}
    </>
  )
}

// âŒ Å¹RÃ“DÅA DUPLIKATÃ“W:
// - Inicjalizowanie query w child component (kaÅ¼dy komponuje own request)
// - RÃ³Å¼ne staleTime wartoÅ›ci (komponent myÅ›li Å¼e cache stale)
// - Prefetch bez proper hydration
```

### Global Query Configuration
```typescript
// src/main.tsx
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 60 * 1000,          // Cache waÅ¼ny 60s
      refetchOnWindowFocus: false,   // Nie refetch na focus
      refetchOnMount: false,         // Nie refetch na mount jeÅ›li cache jest
      retry: 2,                      // 2 retry attempts
    }
  }
})
```

---

## ğŸ“ REGUÅY KOMUNIKACJI I PRACY

### 1. JÄ˜ZYK: POLSKI
- âœ… Wszystkie odpowiedzi po polsku
- âœ… Nazwy zmiennych: `booking.status`, `handleAcceptBooking()`
- âœ… Komentarze w kodzie: polskie wyjaÅ›nienia
- âœ… Commit messages: po polsku

### 2. COMMITY - FORMAT
```
git commit -m "KrÃ³tki opis (7 sÅ‚Ã³w max)

- SzczegÃ³Å‚owa lista zmian
- Po jednym bullet punkcie
- Czemu to robiliÅ›my (business reason)"

PrzykÅ‚ad:
"Refactor BookingsPage UI: use standard components

- Replace hardcoded HTML <a>, <select>, <input> with Button, Link, Select
- Change button sizes from lg to sm for better UX
- Use Link component instead of <a href> for proper routing
- Remove custom Tailwind styling in favor of component defaults"
```

### 3. ROLA: MENTOR/NAUCZYCIEL
Przy kaÅ¼dym znaczÄ…cym kodzie wyjaÅ›nij:
- **CO**: Co ten kod robi?
- **JAK**: Jak to dziaÅ‚a (szczegÃ³lnie React/JS)?
- **CZEMU**: Jaki problem rozwiÄ…zuje?

PrzykÅ‚ad:
```typescript
// Hook do pobierania rezerwacji
export function useRecentBookings(limit: number) {
  // useQuery - React Query hook do fetchu danych z backendu
  // Automatycznie cachuje, deduplicuje, refetchu
  return useQuery({
    queryKey: ['bookings', limit],  // Unique key dla cache
    queryFn: async () => {
      const res = await api.get(`/api/v1/provider/dashboard/bookings?limit=${limit}`);
      return res.data; // Zwraca { data: Booking[], meta: {...} }
    },
    staleTime: 60 * 1000, // Cache waÅ¼ny 60 sekund
  });
}

// CZEMU to dziaÅ‚ania: Zamiast kaÅ¼dego komponentu robiÄ‡ wÅ‚asny fetch (duplikaty),
// React Query centralizuje requesty i dzieli response miÄ™dzy komponenty
```

---

## ğŸ¨ UI KOMPONENTY - ZAWSZE Z `src/components/ui`

### DostÄ™pne komponenty
```typescript
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Select } from '@/components/ui/select';
import { Link } from 'react-router-dom';
import { Card, StatCard } from '@/components/ui/card';
import { 
  PageTitle, SectionTitle, Text, Caption, 
  Badge, StatValue, EmptyText 
} from '@/components/ui/typography';
import { Alert, Dialog, Tabs } from '@/components/ui/';
```

### UÅ¼ycie - PrzykÅ‚ad
```typescript
// âŒ Å¹LES: Hardkodowany HTML
<a href="/provider/bookings" className="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-cyan-500...">
  OtwÃ³rz rezerwacje
</a>

// âœ… POPRAWNIE: Komponent Button + Link
<Link to="/provider/bookings">
  <Button variant="primary" size="sm">
    OtwÃ³rz rezerwacje
  </Button>
</Link>

// Button variants: primary | success | danger | info | warning | neutral
// Button sizes: sm | md | lg
```

### Dodawanie nowych komponentÃ³w
JeÅ›li brakuje, stwÃ³rz w `src/components/ui/[component].tsx`:
```typescript
// src/components/ui/badge.tsx
import { cva } from 'class-variance-authority';

const badgeVariants = cva('px-2 py-1 rounded-full text-xs font-semibold', {
  variants: {
    variant: {
      primary: 'bg-cyan-100 text-cyan-900',
      success: 'bg-green-100 text-green-900',
    }
  }
});

export function Badge({ variant = 'primary', children }: BadgeProps) {
  return <span className={badgeVariants({ variant })}>{children}</span>;
}
```

---

## ğŸ’¾ BAZA DANYCH - BEZ HARDKODOWANIA

### âŒ Å¹LES - Hardkodowane dane
```typescript
const bookings = [
  { id: 1, customer: 'Anna Kowalska', date: '2025-01-01', status: 'confirmed' },
  { id: 2, customer: 'Jan Nowak', date: '2025-01-02', status: 'pending' },
];
```

### âœ… POPRAWNIE - Query hook
```typescript
// src/features/provider/dashboard/hooks/useDashboardData.ts
export function useRecentBookings(limit: number = 5) {
  return useQuery({
    queryKey: ['bookings', limit],
    queryFn: async () => {
      const response = await apiClient.get(
        `/api/v1/provider/dashboard/bookings?limit=${limit}&sort=-created_at`
      );
      return response.data; // Pobiera z bazy!
    }
  });
}

// UÅ¼ycie w komponencie:
export function RecentBookings() {
  const { data, isLoading } = useRecentBookings(5);
  
  if (isLoading) return <Skeleton />;
  
  return (
    <div>
      {data?.map(booking => (
        <BookingCard key={booking.id} booking={booking} />
      ))}
    </div>
  );
}
```

---

## ğŸ§ª DEV MODE - TESTING TOOLS

### Implementacja: Dev-Only Popup z akcjami

```typescript
// src/components/dev/DevTools.tsx
import { useEffect, useState } from 'react';

export function DevTools() {
  const [isOpen, setIsOpen] = useState(false);
  
  if (!import.meta.env.DEV) return null; // Tylko w dev mode!
  
  return (
    <>
      {/* Toggle button - bottom-right corner */}
      <button 
        onClick={() => setIsOpen(!isOpen)}
        className="fixed bottom-4 right-4 z-50 bg-cyan-600 text-white px-3 py-2 rounded-lg text-xs font-bold"
      >
        ğŸ› ï¸ DEV
      </button>
      
      {isOpen && (
        <DevToolsPanel />
      )}
    </>
  );
}

// src/components/dev/DevToolsPanel.tsx
function DevToolsPanel() {
  const queryClient = useQueryClient();
  
  return (
    <div className="fixed bottom-16 right-4 z-50 bg-slate-900 text-white rounded-lg p-4 w-80 max-h-96 overflow-y-auto">
      <h3 className="font-bold mb-4">Dev Tools</h3>
      
      {/* Seed Data */}
      <div className="space-y-2 border-b pb-4 mb-4">
        <h4 className="text-sm font-semibold">ğŸ“Š Seed Data</h4>
        <Button 
          size="sm" 
          onClick={() => seedBookings()}
          className="w-full"
        >
          Generuj 10 rezerwacji
        </Button>
        <Button 
          size="sm" 
          onClick={() => seedMessages()}
          className="w-full"
        >
          Generuj 5 wiadomoÅ›ci
        </Button>
      </div>
      
      {/* Trigger Events */}
      <div className="space-y-2 border-b pb-4 mb-4">
        <h4 className="text-sm font-semibold">ğŸ”” Symuluj Eventy</h4>
        <Button 
          size="sm" 
          onClick={() => simulateNewBooking()}
          className="w-full"
        >
          Nowa rezerwacja
        </Button>
        <Button 
          size="sm" 
          onClick={() => simulateMessage()}
          className="w-full"
        >
          Nowa wiadomoÅ›Ä‡
        </Button>
      </div>
      
      {/* Cache Management */}
      <div className="space-y-2">
        <h4 className="text-sm font-semibold">ğŸ’¾ Cache</h4>
        <Button 
          size="sm" 
          variant="danger"
          onClick={() => queryClient.clear()}
          className="w-full"
        >
          WyczyÅ›Ä‡ cache
        </Button>
      </div>
    </div>
  );
}
```

### UÅ¼ycie w App.tsx
```typescript
export function App() {
  return (
    <>
      <DevTools />  {/* Pojawia siÄ™ tylko w dev mode */}
      {/* reszta aplikacji */}
    </>
  );
}
```

---

## ğŸ“š DOKUMENTACJA - KOD + DOCS

### 1. W KODZIE
```typescript
/**
 * Hook do pobierania ostatnich rezerwacji dostawcy
 * 
 * @param limit - Ile rezerwacji pobraÄ‡ (domyÅ›lnie 5)
 * @returns Object z polami:
 *   - data: Booking[] - tablica rezerwacji z bazy
 *   - isLoading: boolean - czy trwa fetch
 *   - error: Error | null - bÅ‚Ä…d jeÅ›li byÅ‚
 * 
 * @example
 * const { data: bookings, isLoading } = useRecentBookings(10);
 * 
 * @note
 * Hook automatycznie deduplikuje requesty jeÅ›li inicjalizowany
 * w top-level component (np. DashboardPage)
 */
export function useRecentBookings(limit: number = 5) {
  // ...
}
```

### 2. W DOCS - SpÃ³jna struktura
```
docs/
â”œâ”€â”€ ARCHITECTURE.md       - Opis ogÃ³lny systemu
â”œâ”€â”€ FRONTEND_STANDARDS.md - ReguÅ‚y React/TypeScript
â”œâ”€â”€ BEST_PRACTICES.md     - Wzorce i anti-patterns
â”œâ”€â”€ API_ENDPOINTS.md      - Opis endpointÃ³w
â”œâ”€â”€ DATABASE.md           - Schemat bazy danych
â””â”€â”€ DEV_TOOLS.md          - NarzÄ™dzia developerskie
```

---

## ğŸ‘¨â€ğŸ’¼ ADMIN PANEL - KAÅ»DY ELEMENT MUSI SIÄ˜ POJAWIÄ†

### Struktura
```typescript
// KaÅ¼da feature musi mieÄ‡:
// 1. Widok dostawcy: src/features/provider/pages/XyzPage.tsx
// 2. Widok admina: src/features/admin/pages/XyzManagementPage.tsx
// 3. WspÃ³lny Hook: src/hooks/useXyz.ts

// PrzykÅ‚ad: BookingsPage
src/features/provider/pages/BookingsPage.tsx
  â†“ Data + actions (useRecentBookings, handleAcceptBooking)
src/features/admin/pages/BookingsManagementPage.tsx
  â†“ WglÄ…d do wszystkich rezerwacji, moderacja
src/hooks/useBookings.ts
  â†“ WspÃ³lna logika fetchu/mutacji
```

### Admin Features
```typescript
// Admin powinien widzieÄ‡:
// âœ… Wszystkie rezerwacje (nie tylko swoje)
// âœ… HistoriÄ™ zmian statusÃ³w
// âœ… Informacje o dostawcy
// âœ… Opcje do edycji/usuniÄ™cia
// âœ… Analytics (widoki, konwersje)

// src/features/admin/pages/BookingsManagementPage.tsx
export function BookingsManagementPage() {
  const { data: allBookings } = useAllBookings(); // ALL bookings
  const { data: providers } = useProviders();
  
  return (
    <div>
      <h1>ZarzÄ…dzanie rezerwacjami</h1>
      
      {/* Filtry */}
      <Select value={providerFilter} onChange={setProviderFilter}>
        {providers?.map(p => <option value={p.id}>{p.name}</option>)}
      </Select>
      
      {/* Tabela */}
      <table>
        {allBookings?.map(booking => (
          <BookingAdminRow key={booking.id} booking={booking} />
        ))}
      </table>
    </div>
  );
}
```

---

## ğŸš€ WORKFLOW - JAK ZACZÄ„Ä† NOWY FEATURE

### 1. Backend
```bash
# Migration
php artisan make:migration create_new_feature_table

# Model
php artisan make:model NewFeature

# Controller
php artisan make:controller Api/NewFeatureController

# API Endpoint
POST /api/v1/provider/new-feature
```

### 2. Frontend - Hook
```typescript
// src/hooks/useNewFeature.ts
export function useNewFeature() {
  return useQuery({
    queryKey: ['newFeature'],
    queryFn: async () => {
      const res = await apiClient.get('/api/v1/provider/new-feature');
      return res.data;
    }
  });
}
```

### 3. Frontend - Provider Component
```typescript
// src/features/provider/pages/NewFeaturePage.tsx
import { useNewFeature } from '@/hooks/useNewFeature';

export function NewFeaturePage() {
  const { data, isLoading } = useNewFeature();
  
  return (
    <div>
      <PageTitle>Nowa Funkcja</PageTitle>
      {/* UI */}
    </div>
  );
}
```

### 4. Frontend - Admin Component
```typescript
// src/features/admin/pages/NewFeatureManagementPage.tsx
// Duplikuj logic Provider page ale z ALL data access
```

### 5. Dokumentacja
```markdown
# docs/NEW_FEATURE.md

## Opis
Co robi ta feature?

## Backend
- Endpoint: POST /api/v1/provider/new-feature
- Response: NewFeatureResponse

## Frontend
- Hook: useNewFeature()
- Pages: NewFeaturePage, NewFeatureManagementPage
```

### 6. Commit
```bash
git commit -m "Dodaj nowÄ… funkcjÄ™: XYZ

- StwÃ³rz migration, model, controller w Laravel
- Dodaj useNewFeature hook z React Query
- StwÃ³rz NewFeaturePage dla dostawcy
- StwÃ³rz NewFeatureManagementPage dla admina
- Dokumentacja w docs/NEW_FEATURE.md

RozwiÄ…zuje: [feature request]"
```

---

## ğŸ§ª TESTY I DOKUMENTACJA - PO KAÅ»DEJ ZMIANIE LOGIKI

### Zasada: Logika â†’ Testy â†’ Dokumentacja
```
KaÅ¼dÄ… zmianÄ™ kodu majÄ…cÄ… wpÅ‚yw na dziaÅ‚anie systemu musimy:
1. TESTOWAÄ† - dodaÄ‡/zaktualizowaÄ‡ testy (unit, integration, e2e)
2. DOKUMENTOWAÄ† - zaktualizowaÄ‡ komentarze JSDoc w kodzie
3. DOKUMENTOWAÄ† - zaktualizowaÄ‡ docs/ jeÅ›li dotyczy biznesowej logiki
```

### Po kaÅ¼dej zmianie logiki:
```typescript
// âœ… ZAWSZE dodaj/zaktualizuj komentarze

/**
 * Pobiera rezerwacje providera z filtrowaniem po statusie
 * 
 * ZMIANA (2025-01-01): Dodano obsÅ‚ugÄ™ trial mode - rezerwacje
 * poza okresem trial wyÅ›wietlajÄ… siÄ™ ze statusem 'blocked'
 * 
 * @param providerId - ID providera
 * @param status - Status do filtrowania (optional)
 * @returns Booking[] - tablica rezerwacji (bez blocked jeÅ›li no trial)
 * 
 * @example
 * const bookings = await getProviderBookings(123, 'confirmed');
 * // Zwraca rezerwacje confirmed dla providera 123
 * // JeÅ›li provider nie ma trial - rezerwacje spoza trial bÄ™dÄ… 'blocked'
 */
export async function getProviderBookings(providerId: number, status?: string) {
  // Logic...
}

// âœ… ZAWSZE zaktualizuj testy
describe('getProviderBookings', () => {
  it('zwraca rezerwacje dla providera', async () => {
    const bookings = await getProviderBookings(123);
    expect(bookings).toHaveLength(5);
  });
  
  // NOWY TEST - dla trial mode
  it('oznacza rezerwacje spoza trial jako blocked', async () => {
    const provider = { id: 123, trialDays: 7, createdAt: '2025-01-01' };
    const bookings = await getProviderBookings(provider.id);
    
    const futureBooking = bookings.find(b => b.date > addDays(today, 7));
    expect(futureBooking?.status).toBe('blocked');
  });
});
```

### Checklist dla kaÅ¼dego Pull Request
```
Logika zmieniona â†’ ObowiÄ…zkowe:
â–¡ Unit test - testy dla samej funkcji
â–¡ Integration test - testy z API/DB
â–¡ JSDoc - dokumentacja w kodzie (czemu zmiana, co siÄ™ zmieniÅ‚o)
â–¡ docs/XYZ.md - aktualizacja dokumentacji biznesowej
â–¡ Komentarz w kodzie: "ZMIANA (data): co dokÅ‚adnie siÄ™ zmieniÅ‚o"
```

### Typy zmian logiki wymagajÄ…ce testÃ³w+docs:
```
ğŸ”´ KRYTYCZNE (zawsze testing+docs):
  - Zmiana statusÃ³w rezerwacji
  - Zmiana logiki pÅ‚atnoÅ›ci/subskrypcji
  - Zmiana autoryzacji/permissions
  - Zmiana kalkulacji (ceny, Trust Score)
  
ğŸŸ¡ WAÅ»NE (zawsze docs, testy optional):
  - Nowy endpoint API
  - Nowy hook/util
  - Zmiana struktury komponentu
  
ğŸŸ¢ MINOR (docs wymagane, testy optional):
  - Zmiana textu/labeli
  - Refactor kodu bez zmiany logiki
  - CSS/styling updates
```

---

## âœ… CHECKLIST - PRZED COMMITEM

- [ ] Kod uÅ¼ywa tylko komponentÃ³w z `src/components/ui`
- [ ] Brak hardkodowanych danych (wszystko z API)
- [ ] Hook inicjalizowany w top-level (deduplication)
- [ ] Odpowiednie stale/refetch values
- [ ] â­ **Dokumentacja w kodzie** - JSDoc komentarze zaktualizowane
- [ ] â­ **Testy** - dodane/zaktualizowane dla zmian logiki
- [ ] â­ **docs/** - dokumentacja biznesowa zaktualizowana (jeÅ›li zmiana logiki)
- [ ] Admin panel ma dostÄ™p do tej samej feature
- [ ] Build siÄ™ buduje bez nowych bÅ‚Ä™dÃ³w
- [ ] Commit message po polsku z szczegÃ³Å‚ami
- [ ] Dev tools - dodane testy/seed data
- [ ] docs/ARCHITECTURE.md zaktualizowana

---

## ğŸ“ NAUCZANIE - KRÃ“TKIE WYJAÅšNIENIA REACTA

### useQuery (React Query)
```typescript
// Fetch danych z backendu + cache management
const { data, isLoading, error } = useQuery({
  queryKey: ['bookings', id],    // Cache key - unique identifier
  queryFn: async () => {          // Async function do fetchu
    const res = await fetch(...);
    return res.json();
  }
});

// React Query automatycznie:
// âœ… Cachuje response (staleTime: 60s)
// âœ… Deduplikuje requesty (jeÅ›li kilka components robi useQuery same queryKey)
// âœ… Refetchu na window focus (jeÅ›li refetchOnWindowFocus: true)
// âœ… Retry failed requesty
```

### useMutation (React Query)
```typescript
// POST/PUT/DELETE operacje (zmÄ›ny w bazie)
const { mutate, isPending } = useMutation({
  mutationFn: async (data) => {
    return await apiClient.post('/api/...', data);
  },
  onSuccess: (response) => {
    // Invalidate query cache - wymusimy refetch
    queryClient.invalidateQueries({ queryKey: ['bookings'] });
  }
});

// UÅ¼ycie
<button onClick={() => mutate({ id: 1, status: 'confirmed' })}>
  Zaakceptuj
</button>
```

### useEffect
```typescript
// Efekty uboczne (fetch, subscriby, timery)
useEffect(() => {
  // Kod tutaj uruchamia siÄ™ JEÅšLI zmieniÅ‚y siÄ™ dependencies
  const fetchData = async () => {
    const data = await fetch(...);
  };
  fetchData();
}, [dependency]); // JeÅ›li dependency siÄ™ zmieni - uruchom effect ponownie

// Unikaj effectÃ³w - uÅ¼ywaj useQuery zamiast tego!
```

---

## ğŸ“ KONTAKT/PYTANIA

JeÅ›li coÅ› nie jest jasne:
1. Zapytaj - wyjaÅ›niÄ™ detali
2. PokaÅ¼ przykÅ‚ad co chcesz zrobiÄ‡
3. Razem naprawimy/wyjaÅ›nimy

Celem jest nauczanie przez robienie! ğŸš€
